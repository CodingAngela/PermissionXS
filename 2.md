ä¸€ã€å‰æœŸæ‘¸ç´¢ï¼ˆå»ºè®®æ®µè½æ ¼å¼é€‰æ‹©ç¼–è¾‘å·¥å…·æ ä¸­çš„â€œæ ‡é¢˜3â€ï¼‰

1.Javaï¼ˆå»ºè®®æ®µè½æ ¼å¼é€‰æ‹©ç¼–è¾‘å·¥å…·æ ä¸­çš„â€œæ ‡é¢˜4â€ï¼‰

Androidå¼€å‘ç¦»ä¸å¼€Javaï¼ˆKotlinï¼šå½“æˆ‘ä¸å­˜åœ¨ï¼Ÿï¼‰ï¼Œéœ€è¦æŒæ¡çš„Javaç‰¹æ€§åŒ…æ‹¬ä½†ä¸é™äºï¼š

é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼šç†è§£ç±»ã€å¯¹è±¡ã€ç»§æ‰¿ã€å¤šæ€ç­‰é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ¦‚å¿µå’ŒåŸåˆ™ã€‚

å¯èƒ½å’ŒC++æœ‰å¼‚æ›²åŒå·¥ä¹‹å¤„ï¼Ÿ

å¼‚å¸¸å¤„ç†ï¼šå­¦ä¹ å¦‚ä½•ä½¿ç”¨ try-catch å—æ¥å¤„ç†å¼‚å¸¸ï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»ã€‚

å¥å£®æ€§ï¼Ÿé€‚é…å¤šç‰ˆæœ¬ï¼Ÿ

æ³›å‹ï¼šæŒæ¡æ³›å‹çš„ä½¿ç”¨ï¼Œä»¥æé«˜ä»£ç çš„ç±»å‹å®‰å…¨æ€§å’Œé‡ç”¨æ€§ã€‚

ä¸æŒ‡å®šç±»å‹ï¼Œç±»ä¼¼Kotlinä¸­çš„<T>ï¼Ÿå­˜åœ¨å®ä¾‹åŒ–ä¸Šçš„å·®å¼‚

é›†åˆæ¡†æ¶ï¼šç†Ÿæ‚‰ Java æä¾›çš„é›†åˆæ¡†æ¶ï¼Œå¦‚ Listã€Setã€Map ç­‰ï¼Œä»¥åŠå®ƒä»¬çš„å¸¸è§ç”¨æ³•å’Œæ€§èƒ½ç‰¹ç‚¹ã€‚

ç±»ä¼¼C++ä¸­çš„STLå®¹å™¨ï¼Ÿçœ‹ä¸Šå»æŒºå¥½ç”¨çš„ï¼Œå¯èƒ½æœ‰ä¸€äº›å¥½ç©çš„è¯­æ³•ç³–

å¤šçº¿ç¨‹ç¼–ç¨‹ï¼šäº†è§£å¤šçº¿ç¨‹ç¼–ç¨‹çš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨çº¿ç¨‹ã€åŒæ­¥å’Œé”æ¥å¤„ç†å¹¶å‘æƒ…å†µã€‚

å¤šçº¿ç¨‹æ¶‰åŠåˆ°Serviceåœ¨ä¸»çº¿ç¨‹ä¸­çš„å ç”¨é—®é¢˜

I/O æ“ä½œï¼šæŒæ¡æ–‡ä»¶å’Œæµçš„æ“ä½œï¼ŒåŒ…æ‹¬è¯»å–å’Œå†™å…¥æ–‡ä»¶ã€ç½‘ç»œé€šä¿¡ç­‰ã€‚

ä¸ContentProviderç›¸å…³ï¼Œä»¥åŠæ•°æ®çš„æŒä¹…åŒ–

Lambda è¡¨è¾¾å¼ï¼šäº†è§£å¹¶ä½¿ç”¨ Lambda è¡¨è¾¾å¼æ¥ç®€åŒ–ä»£ç ï¼Œæé«˜å¯è¯»æ€§å’Œç®€æ´æ€§ã€‚

è¯­æ³•ç³–å¥½åƒ

æ³¨è§£ï¼šå­¦ä¹ å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨æ³¨è§£ï¼Œä»¥åŠå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£ã€‚

æé«˜å¯è¯»æ€§å‘—

åå°„ï¼šäº†è§£åå°„çš„æ¦‚å¿µå’Œç”¨æ³•ï¼Œä»¥åŠå¦‚ä½•åœ¨è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯å¹¶è°ƒç”¨å…¶æ–¹æ³•ã€‚

Javaæœ€é‡è¦çš„ç‰¹æ€§ã€‚å¤ªtméš¾æ‡‚

Java 8 æ–°ç‰¹æ€§ï¼šç†Ÿæ‚‰ Java 8 å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œå¦‚ Stream APIã€Optional ç±»ç­‰ï¼Œä»¥æé«˜ä»£ç çš„ç®€æ´æ€§å’Œæ€§èƒ½ã€‚

ç‰¹ç‰ˆæœ¬éƒ½ä¼šæœ‰ä¸€äº›å¥½ç©çš„ç‰¹æ€§å¼•å…¥

1ï¼‰æ–‡æœ¬æ¡£ä¸‰çº§æ ‡é¢˜ï¼ˆå»ºè®®æ®µè½æ ¼å¼é€‰æ‹©ç¼–è¾‘å·¥å…·æ ä¸­çš„â€œæ ‡é¢˜5â€ï¼‰

æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹ æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹æ–‡å­—ç¤ºä¾‹ã€‚

2.Androidå¼€å‘ç¯å¢ƒæ­å»º

ä¸‡äº‹å¼€å¤´éš¾ï¼Œè€Œè¿™ç¬¬ä¸€æ­¥å°±æ˜¯ç¯å¢ƒæ­å»ºã€‚Javaã€SDKã€NDKå„ç§ç‰ˆæœ¬å…¼å®¹é—®é¢˜å¾ˆå®³æ€•é…çƒ‚æ‰ï¼Œä½†åˆèƒ½æ€ä¹ˆåŠå‘¢ï¼Œç¡¬ç€å¤´çš®ä¸Šå§ï¼Œå¸Œæœ›â€œç¬¬ä¸€è¡Œä»£ç ï¼šAndroidâ€åˆ«ææˆ‘å¿ƒæ€ã€‚

https://developer.android.com/studio/installå®‰è£…android studio dmg

android stdioå¯åŠ¨åè¿›å…¥wizardï¼Œé€‰æ‹©standardã€‚sdkè·¯å¾„æ˜¯/Users/an9ela/Library/Android/sdk

å¼€å§‹å®‰è£…SDK34ç­‰å¹³å°å·¥å…·â€œInstall Google APIs Intel x86_64 Atom System Image API 34 (revision 13)â€ï¼Œä½†ä¸ºå•¥æ²¡çœ‹åˆ°NDKå’ŒJava ğŸ‘€

å®‰è£…å®Œæˆåç›´æ¥æ–°å»ºé¡¹ç›®ï¼Œå¼€å¯ä¸€ä¸ªempty view projectï¼Œé€‰æ‹©Javaä¹‹åå®Œæˆï¼Œä»ç”Ÿæˆçš„gradleä¸­çœ‹åˆ°ä½¿ç”¨çš„æ˜¯Java8ï¼Œè¯´æ˜Android Stdioå†…ç½®äº†JREï¼Œå¹¶ä½¿ç”¨Gradleåœ¨åå°ä½¿ç”¨å†…ç½®çš„JDKæ¥ç¼–è¯‘Javaæºä»£ç ã€‚/Applications/Android Studio.app/Contents/jbrï¼ˆjbræ˜¯JetBrainçš„JDKå®šåˆ¶ç‰ˆæœ¬ï¼‰

2.1.Android Studioé¡¹ç›®ç»“æ„

.gradleå’Œ.ideaç”±Android Studioè‡ªåŠ¨ç”Ÿæˆï¼Œä¸èƒ½è‡ªå·±ä¿®æ”¹

appå­˜æ”¾é¡¹ç›®ä»£ç å’Œèµ„æº

buildç¼–è¯‘è‡ªåŠ¨ç”Ÿæˆ

androidTestç”¨æ¥ç¼–å†™Android Testæµ‹è¯•ç”¨ä¾‹çš„ï¼Œå¯ä»¥å¯¹é¡¹ç›®è¿›è¡Œä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•

javaæ”¾ç½®javaä»£ç çš„åœ°æ–¹

resé¡¹ç›®ä¸­ä½¿ç”¨åˆ°çš„æ‰€æœ‰å›¾ç‰‡ã€å¸ƒå±€ã€å­—ç¬¦ä¸²ç­‰èµ„æºéƒ½è¦å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‚å½“ç„¶è¿™ä¸ªç›®å½•ä¸‹è¿˜æœ‰å¾ˆå¤šå­ç›®å½•ï¼Œå›¾ç‰‡æ”¾åœ¨drawableç›®å½•ä¸‹ï¼Œå¸ƒå±€æ”¾åœ¨layoutç›®å½•ä¸‹ï¼Œå­—ç¬¦ä¸²æ”¾åœ¨valuesç›®å½•ä¸‹

AndroidManifest.xmlæ•´ä¸ªAndroidé¡¹ç›®çš„é…ç½®æ–‡ä»¶ï¼Œç¨‹åºä¸­å®šä¹‰çš„æ‰€æœ‰å››å¤§ç»„ä»¶éƒ½éœ€è¦åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œæ³¨å†Œï¼Œå¦å¤–è¿˜å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ç»™åº”ç”¨ç¨‹åºæ·»åŠ æƒé™å£°æ˜

testç”¨æ¥ç¼–å†™Unit Testæµ‹è¯•ç”¨ä¾‹çš„ï¼Œæ˜¯å¯¹é¡¹ç›®è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•çš„å¦ä¸€ç§æ–¹å¼

build.gradleæ˜¯appæ¨¡å—çš„gradleæ„å»ºè„šæœ¬ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­ä¼šæŒ‡å®šå¾ˆå¤šé¡¹ç›®æ„å»ºç›¸å…³çš„é…ç½®

proguard-rules.proç”¨äºæŒ‡å®šé¡¹ç›®ä»£ç çš„æ··æ·†è§„åˆ™

gradleç›®å½•ä¸‹åŒ…å«äº†gradle wrapperçš„é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨gradle wrapperçš„æ–¹å¼ä¸éœ€è¦æå‰å°†gradleä¸‹è½½å¥½ï¼Œè€Œæ˜¯ä¼šè‡ªåŠ¨æ ¹æ®æœ¬åœ°çš„ç¼“å­˜æƒ…å†µå†³å®šæ˜¯å¦éœ€è¦è”ç½‘ä¸‹è½½gradle

.gitignoreæŒ‡å®šæ’é™¤ç‰ˆæœ¬æ§åˆ¶ä¹‹å¤–çš„æ–‡ä»¶

build.gradleé¡¹ç›®å…¨å±€çš„gradleæ„å»ºè„šæœ¬

gradle.propertieså…¨å±€çš„gradleé…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œé…ç½®çš„å±æ€§å°†ä¼šå½±å“åˆ°é¡¹ç›®ä¸­æ‰€æœ‰çš„gradleç¼–è¯‘è„šæœ¬

gradlewå’Œgradlew.batç”¨äºå‘½ä»¤è¡Œæ‰§è¡Œgradleå‘½ä»¤

local.propertiesç”¨äºæŒ‡å®šæœ¬æœºä¸­Android SDKè·¯å¾„

setting.gradleæŒ‡å®šé¡¹ç›®ä¸­æ‰€æœ‰å¼•å…¥çš„æ¨¡å—

2.2.å®æ“é—®é¢˜è®°å½•

ï¼ˆ1ï¼‰æ‰‹æœºrootåadb shellè¿ä¸Šè¿˜æ˜¯æ™®é€šç”¨æˆ·æƒé™ï¼Œè€Œä¸”æ²¡æ‰¾åˆ°su

ï¼ˆ2ï¼‰javaé‡Œçš„åŒ…æ˜¯æ€ä¹ˆç®¡ç†çš„

ï¼ˆ3ï¼‰xmlæ ¼å¼é‡Œçš„æ ‡ç­¾é…å¯¹é—®é¢˜(solved)

ï¼ˆ4ï¼‰æ‰€æœ‰èµ„æºéƒ½åœ¨Ræ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªèµ„æºidï¼Œé‚£Ræ–‡ä»¶æœ¬è´¨æ˜¯ï¼Ÿèµ„æºçš„ç»Ÿä¸€ç®¡ç†ï¼Ÿ(solved)

ï¼ˆ5ï¼‰å¦‚ä½•ç†è§£Contextæ¦‚å¿µ(solved)

ï¼ˆ6ï¼‰ç»™è‡ªå·±åˆ›å»ºçš„Second_Activityè®¾ç½®intent-filterä¸­actionä¸ºâ€œandroid.intent.action.VIEWâ€åä¸ºä½•ä½¿ç”¨éšç¤ºintentè°ƒä¸å‡ºæ¥(solved)

ï¼ˆ7ï¼‰startActiviryForResultæ–¹æ³•è¢«ç¦ç”¨äº†ï¼Œé‚£è¯¥å¦‚ä½•åˆ©ç”¨intentå›ä¼ è¢«å¯åŠ¨Activityæ‰€äº§ç”Ÿçš„æ•°æ®ç»“æœå‘¢ï¼ˆsolvedï¼‰

å±•ç¤ºä»£ç ç¤ºä¾‹ï¼š

public class FirstActivity extends AppCompatActivity {
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        //è¯¥æ–¹æ³•è¦æ”¾åœ¨onCreateé‡Œé¢ï¼Œä¸èƒ½æ”¾åœ¨ç›‘å¬å™¨é‡Œ
        ActivityResultLauncher launcher = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(), new ActivityResultCallback<ActivityResult>() {
            @Override
            public void onActivityResult(ActivityResult result) {
                if(result.getResultCode() == Activity.RESULT_OK){
                    Log.d("data_return", result.getData().getStringExtra("data_return"));
                }
            }
        });

        Button button1 = (Button) findViewById(R.id.button_1);
        button1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent(FirstActivity.this,SecondActivity.class);
                launcher.launch(intent);//å¯åŠ¨intentè·³è½¬
            }
        });
    }
}

// SecondActivity.java
public class SecondActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_second);

        Button button2 = (Button) findViewById(R.id.button_2);
        button2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                Intent intent = new Intent();
                intent.putExtra("data_return","the data of returning to FirstActivity");
                setResult(RESULT_OK,intent);
                finish();
            }
        });
    }
}

ï¼ˆ8ï¼‰OnBackPressedåœ¨API 33+è¢«ç¦ç”¨ï¼Œä¸ºäº†å¼•å…¥æ»‘åŠ¨è¿”å›çš„åŠŸèƒ½ï¼Œé‚£æœ‰ä»€ä¹ˆæ›¿ä»£æ–¹æ³•ï¼ˆsolvedï¼‰

ä»£ç ç¤ºä¾‹ï¼š

protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);

        OnBackPressedCallback callback = new OnBackPressedCallback(true) {
            @Override
            public void handleOnBackPressed() {
                // handle backpressed here
            }
        };
        getOnBackPressedDispatcher().addCallback(this, callback);

è¿™æ ·worksä½†æ­£å¸¸çš„è¿”å›åŠŸèƒ½å°±åœæ­¢å·¥ä½œäº†......you have to tell android where to goï¼Ÿ

ä¹Ÿä¸ä¸€å®šï¼Œå¯ä»¥åœ¨handleOnBackPressedä¸­è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œè‡ªå®šä¹‰çš„backpressedé€»è¾‘å°±è¿›å…¥ifï¼Œå¦åˆ™åœ¨elseä¸­setEnable(false)æ¥ç¦ç”¨è¿™ä¸ªå›è°ƒå¹¶è°ƒç”¨requireActivity().onBackPressed()æ¥æ‰§è¡Œé»˜è®¤è¿”å›è¡Œä¸ºã€‚

OnBackPressedCallbackè¿˜å…è®¸ä½ æ ¹æ®å½“å‰åº”ç”¨çš„çŠ¶æ€åŠ¨æ€å¯ç”¨æˆ–ç¦ç”¨æ‹¦æˆªã€‚ä¾‹å¦‚ï¼Œå½“ç”¨æˆ·å¤„äºåº”ç”¨çš„æŸä¸ªç‰¹å®šè§†å›¾æ—¶ï¼Œå¯èƒ½æƒ³è¦æ‹¦æˆªè¿”å›æŒ‰é’®å¹¶æ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œï¼Œè€Œåœ¨å…¶ä»–è§†å›¾ä¸­åˆ™ä¿æŒé»˜è®¤è¡Œä¸º

ï¼ˆ9ï¼‰ä¸ºä»€ä¹ˆæœ‰çš„ç±»åœ¨å®ä¾‹åŒ–çš„ä½¿ç”¨ç›´æ¥ç”¨ç±»åå¦‚Bottonè€Œæœ‰çš„éœ€è¦åŠ ä¸Š.Builderå¦‚AlertDialog.Builderï¼Ÿï¼ˆsolvedï¼‰

ï¼ˆ10ï¼‰åœ¨AlertDialogçš„å¼¹çª—é‡Œçš„OKç‚¹äº‹ä»¶å¤„ç†ä¸­æ·»åŠ Toastå¹¶è®¾ç½®Contextä¸ºFirstActivityä½†ç‚¹å‡»okåæ²¡æœ‰Toastæ˜¾ç¤ºï¼Ÿåˆæ­¥çŒœæµ‹ç‚¹å‡»OKäº‹ä»¶å¤„ç†æ—¶FirstActivityè¢«å±è”½äº¤äº’ï¼Œä½¿å¾—Toastä¸å¯è§ã€‚ï¼ˆåˆæ„Ÿè§‰å’Œä¼ å…¥Toastçš„ç¬¬ä¸€å‚æ•°æœ‰å…³ç³»ï¼‰

ï¼ˆ11ï¼‰ç³»ç»Ÿå¸ƒå±€æ–‡ä»¶å†™æ³•å¥½å¥‡æ€ª

ï¼ˆ12ï¼‰é™æ€æ³¨å†Œçš„å¹¿æ’­æ¥æ”¶å™¨ä¸ºä»€ä¹ˆä¸èƒ½åœ¨onReceiveä¸­å¼¹å‡ºå¯¹è¯æ¡†è¿™æ ·çš„UIæ§ä»¶ï¼Ÿï¼ˆsolvedä½†ä»ç„¶éœ€è¦ç»§ç»­æ·±å…¥ç†è§£Contextï¼‰

å¼¹å‡ºå¯¹è¯æ¡†ç­‰UIæ§ä»¶é€šå¸¸éœ€è¦ä¾èµ–äºActivityä¸Šä¸‹æ–‡ï¼Œå› ä¸ºå®ƒä»¬éœ€è¦ä¸€ä¸ªåœ¨å±å¹•ä¸Šå·²ç»å­˜åœ¨çš„çª—å£æ¥é™„ç€ï¼ˆDialog åˆ™å¿…é¡»æ˜¯åœ¨ä¸€ä¸ªActivityä¸Šå¼¹å‡ºï¼Œç³»ç»Ÿç±»å‹çš„Dialogé™¤å¤–ï¼‰ã€‚

é™æ€æ³¨å†Œçš„å¹¿æ’­æ¥æ”¶å™¨æ²¡æœ‰ä¸ä¹‹å…³è”çš„Activityä¸Šä¸‹æ–‡ï¼Œå› æ­¤å®ƒæ— æ³•ç¡®ä¿æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„çª—å£æ¥æ˜¾ç¤ºå¯¹è¯æ¡†ã€‚

å¦‚æœéœ€è¦åœ¨æ¥æ”¶åˆ°å¹¿æ’­åæ˜¾ç¤ºUIï¼Œåº”å½“ä½¿ç”¨é€šçŸ¥ï¼ˆNotificationsï¼‰æˆ–è€…å¯åŠ¨ä¸€ä¸ªåŒ…å«UIæ§ä»¶çš„Activityã€‚

ï¼ˆ13ï¼‰Androidç³»ç»Ÿçš„å¿«é€Ÿå‘å±•å¯¼è‡´å‡ ä¹æ¯ä¸€ä¸ªç‰ˆæœ¬éƒ½å¯¹æˆ–å¤šæˆ–å°‘çš„åŠŸèƒ½APIæ¥å£è¿›è¡Œäº†ä¿®æ”¹ï¼ŒAPIçš„ä¸ç¨³å®šé—®é¢˜å¦‚ä½•è§£å†³ï¼Œè¿™ä¹Ÿæ¶‰åŠåˆ°ä¸åŒå‹å·æ‰‹æœºçš„å…¼å®¹æ€§é—®é¢˜ã€‚æ·»åŠ ifç‰ˆæœ¬åˆ¤æ–­ï¼Ÿä½¿ç”¨AndroidXåº“ä¸­çš„å…¼å®¹API

2.3.å¼€å‘å°trick/tips

OnCreateå¤–"logt"ï¼Œå†…éƒ¨å†"logd/i/w"

é™æ€æ³¨å†Œçš„Receiveråœ¨Android8.0ä¹‹åä¸èƒ½æ¥å—éšå¼å¹¿æ’­

å…¬æœ‰ï¼ˆpublicï¼‰ç±»ä¸­çš„æ–¹æ³•å¦‚æœæ˜¯é™æ€ï¼ˆstaticï¼‰çš„ï¼Œåˆ™å¯ä»¥ä¸éœ€è¦ç±»çš„å®ä¾‹åŒ–å°±èƒ½è°ƒç”¨ã€‚å¦‚æœæ˜¯éé™æ€çš„å®ä¾‹æ–¹æ³•ï¼Œåˆ™éœ€è¦å…ˆåˆ›å»ºç±»çš„å®ä¾‹æ‰èƒ½è°ƒç”¨ã€‚

å»ºè®®æ·±å…¥äº†è§£ä¸€ä¸‹Context

æ¯ä¸ªServiceåªä¼šå­˜åœ¨ä¸€ä¸ªå®ä¾‹

3.ç›´æ¥å¼€æ

ç¯å¢ƒæ­å¥½ç›´æ¥åˆ›å»ºä¸€æ‰‹é¡¹ç›®ï¼Œæ‰“ç®—å…ˆè¯•è¯•åˆ©ç”¨AccessibilityServiceè‡ªåŠ¨æŠ¢çº¢åŒ…æ˜¯æ€ä¹ˆåšåˆ°çš„ã€‚

ç›®å‰æŒæ¡çš„AccessibilityServiceæƒ…æŠ¥ï¼š

Android 4.0 (Ice Cream Sandwich) åŠä¹‹å‰

è¾…åŠ©åŠŸèƒ½æœåŠ¡è¾ƒä¸ºåŸºç¡€ï¼Œä¸»è¦æä¾›äº†å¯¹è¯æœ—è¯»ï¼ˆText-to-Speechï¼‰ã€è§¦æ‘¸åé¦ˆç­‰æœåŠ¡ã€‚

ç”¨æˆ·å¯ä»¥åœ¨è®¾ç½®ä¸­å¼€å¯æˆ–å…³é—­è¾…åŠ©åŠŸèƒ½ã€‚

Android 4.1 (Jelly Bean)

å¼•å…¥äº†â€œå¯è®¿é—®æ€§èŠ‚ç‚¹ä¿¡æ¯â€ï¼ˆAccessibilityNodeInfoï¼‰ï¼Œå…è®¸è¾…åŠ©æœåŠ¡æ£€ç´¢çª—å£å†…å®¹çš„æ›´å¤šä¿¡æ¯ã€‚

è¾…åŠ©åŠŸèƒ½æœåŠ¡å¯ä»¥å¯¹ç”¨æˆ·ç•Œé¢è¿›è¡Œæ›´æ·±å…¥çš„æŸ¥è¯¢å’Œæ§åˆ¶ã€‚

Android 5.0 (Lollipop)

å¢å¼ºäº†è¾…åŠ©åŠŸèƒ½æœåŠ¡çš„èƒ½åŠ›ï¼Œæ¯”å¦‚å¯ä»¥æ¨¡æ‹Ÿç‚¹å‡»ã€æ»‘åŠ¨ç­‰æ‰‹åŠ¿æ“ä½œã€‚

ä¸ºç”¨æˆ·æä¾›äº†æ›´ä¸°å¯Œçš„è¾…åŠ©åŠŸèƒ½æœåŠ¡é…ç½®é€‰é¡¹ã€‚

Android 6.0 (Marshmallow)

å¼•å…¥äº†è¿è¡Œæ—¶æƒé™ç³»ç»Ÿï¼Œå¯¹äºæŸäº›æƒé™ï¼Œè¾…åŠ©åŠŸèƒ½æœåŠ¡éœ€è¦åœ¨è¿è¡Œæ—¶è¯·æ±‚ç”¨æˆ·æˆæƒã€‚

æé«˜äº†ç”¨æˆ·å¯¹åº”ç”¨æƒé™è¯·æ±‚çš„æ§åˆ¶èƒ½åŠ›ã€‚

Android 7.0 (Nougat)

ç»§ç»­å¢å¼ºè¾…åŠ©åŠŸèƒ½æœåŠ¡APIï¼ŒåŒ…æ‹¬æ”¹è¿›çš„è§†å›¾éå†å’Œæ›´å¤šçš„ç”¨æˆ·ç•Œé¢æ“ä½œã€‚

æä¾›äº†æ›´ç»†ç²’åº¦çš„æƒé™ç®¡ç†ã€‚

Android 8.0 (Oreo)

å¼•å…¥äº†â€œè‡ªåŠ¨å¡«å……â€ï¼ˆAutofillï¼‰æ¡†æ¶ï¼Œè¾…åŠ©åŠŸèƒ½æœåŠ¡å¯ä»¥å¸®åŠ©ç”¨æˆ·è‡ªåŠ¨å¡«å……è¡¨å•ã€‚

å¯¹äºæ»¥ç”¨è¾…åŠ©åŠŸèƒ½æœåŠ¡çš„åº”ç”¨ï¼ŒGoogle PlayåŠ å¼ºäº†æ”¿ç­–é™åˆ¶ã€‚

Android 9.0 (Pie) å’Œ Android 10

ç»§ç»­å®Œå–„è¾…åŠ©åŠŸèƒ½æœåŠ¡ï¼ŒåŒ…æ‹¬æ›´å¥½çš„å¯¼èˆªå’Œç”¨æˆ·ç•Œé¢æ§åˆ¶ã€‚

å¼ºåŒ–äº†å¯¹è¾…åŠ©åŠŸèƒ½æœåŠ¡ä½¿ç”¨æƒé™çš„å®¡æ ¸å’Œæ§åˆ¶ã€‚

Android 11 åŠä»¥å

å¼•å…¥äº†æ›´å¤šçš„éšç§å’Œå®‰å…¨æªæ–½ï¼Œå¯¹äºè¾…åŠ©åŠŸèƒ½æœåŠ¡çš„æƒé™è¦æ±‚æ›´åŠ ä¸¥æ ¼ã€‚

ç”¨æˆ·å¯¹äºè¾…åŠ©åŠŸèƒ½æœåŠ¡çš„æˆæƒå…·æœ‰æ›´é«˜çš„é€æ˜åº¦å’Œæ§åˆ¶åŠ›ã€‚

æ¯ä¸ªæ–°ç‰ˆæœ¬çš„Androidéƒ½åœ¨å°è¯•å¹³è¡¡è¾…åŠ©åŠŸèƒ½æœåŠ¡çš„å¼ºå¤§åŠŸèƒ½å’Œç”¨æˆ·éšç§ä¹‹é—´çš„å…³ç³»ã€‚å¼€å‘è€…éœ€è¦éµå¾ªæœ€æ–°çš„æŒ‡å—æ¥ç¡®ä¿ä»–ä»¬çš„åº”ç”¨ç¬¦åˆæœ€æ–°çš„å®‰å…¨å’Œéšç§æ ‡å‡†ã€‚åŒæ—¶ï¼Œç”¨æˆ·éœ€è¦å¯¹æˆäºˆç»™è¾…åŠ©åŠŸèƒ½æœåŠ¡çš„æƒé™ä¿æŒè­¦è§‰ï¼Œåªä¸ºä¿¡ä»»çš„æœåŠ¡æˆæƒï¼ˆè¶Šæ¥è¶Šç»†ç²’åº¦ï¼‰

3.1 UIæ¡†æ¶æ­å»º

é‡‡ç”¨ListViewæ–¹å¼å¹¶è‡ªå®šä¹‰PermissionAdapterï¼Œé€šè¿‡é‡å†™getViewæ–¹æ³•ä½¿å¾—è‡ªå®šä¹‰æ¯ä¸ªå­æ§ä»¶ï¼Œå¹¶é€šè¿‡onItemClickå¤„ç†å­æ§ä»¶ç‚¹å‡»äº‹ä»¶ã€‚å…·ä½“å¦‚ä¸‹ï¼š

1ã€è‡ªå®šä¹‰Permissionå®ä½“å…¬å…±ç±»ã€‚ä½œä¸ºæµ‹è¯•ç±»ä¸­åªæœ‰ä¸€ä¸ªç§æœ‰æˆå‘˜nameå’Œå…¬ç”¨æ–¹æ³•getNameï¼Œä¹‹åè¿›ä¸€æ­¥å¯ä»¥æ·»åŠ å…·ä½“æƒé™ç›¸å…³å±æ€§

public class Permission {
    private String name;
    public Permission(String name) {
        this.name = name;
    }
    public String getName() {
        return name;
    }
}

2ã€ä¸ºListViewçš„å­é¡¹åˆ›å»ºè‡ªå®šä¹‰çš„å¸ƒå±€ã€‚é€šè¿‡åœ¨layoutç›®å½•ä¸‹æ–°å»ºpermission_item.xmlï¼Œå¹¶åœ¨å…¶ä¸­æ·»åŠ TextView

<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:orientation="vertical"
    android:layout_width="match_parent"
    android:layout_height="wrap_content">

<!--    <Button-->
<!--        android:id="@+id/bottom1"-->
<!--        android:layout_width="match_parent"-->
<!--        android:layout_height="wrap_content"/>-->
    <TextView
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:id="@+id/text_name"
        android:layout_gravity="center_vertical"
        android:textSize="90px"
        android:layout_margin="10dp"
        />

</LinearLayout>

3ã€åˆ›å»ºè‡ªå®šä¹‰ç±»å‹çš„é€‚é…å™¨ã€‚è¯¥é€‚é…å™¨ç»§æ‰¿ArrayAdapterï¼Œå¹¶æŒ‡å®šæ³›å‹ä¸ºPermissionã€‚

PermissionAdapterç±»ä¸­å®šä¹‰çš„æ„é€ å‡½æ•°å°†ä¸Šä¸‹æ–‡ã€ListViewå­é¡¹å¸ƒå±€idå’ŒList<Permission>æ•°æ®ä¼ é€’è¿›æ¥ç»™çˆ¶ç±»æ„é€ ã€‚é‡å†™getViewæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åœ¨æ¯ä¸ªå­é¡¹è¢«æ»šåŠ¨è‡³å±å¹•å†…æ—¶ä¼šè¢«è°ƒç”¨ã€‚getItemè·å–è¯¥å­é¡¹çš„å®ä¾‹ï¼ŒLayoutInflaterä¸ºè¯¥å­é¡¹ä¼ å…¥å¸ƒå±€ã€‚ä¹‹åè·å–å­å¸ƒå±€TextViewæ§ä»¶å¹¶é€šè¿‡setTextè®¾ç½®name

public class PermissionAdapter extends ArrayAdapter<Permission> {
    private int resourceId;
    public PermissionAdapter(Context context, int textViewResourceId, List<Permission> objects) {
        super(context, textViewResourceId, objects);
        resourceId = textViewResourceId;
    }

    @NonNull
    @Override
    public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {
        Permission permission = getItem(position);
        View view;
        if (convertView == null) {
            view = LayoutInflater.from(getContext()).inflate(resourceId, parent, false);
        }
        else {
            view = convertView;
        }

        TextView textView = (TextView) view.findViewById(R.id.text_name);
        textView.setText(permission.getName());
//        Button button = (Button) view.findViewById(R.id.bottom1);
//        button.setText(permission.getName());
        return view;
    }
}

4ã€åœ¨MainActivityä¸­æ·»åŠ æ“ä½œé€»è¾‘ã€‚å®šä¹‰initPermissionå®Œæˆå¯¹List<Permission>çš„åˆå§‹åŒ–ï¼Œæ„é€ å‡ºPermissionAdapterå¹¶å¯¹ListView.setAdapterã€‚ä½¿ç”¨setOnItemClickListeneræ–¹æ³•æ³¨å†Œç›‘å¬å™¨ï¼Œé‡å†™å›è°ƒå‡½æ•°onItemClické€šè¿‡positionåˆ¤æ–­ç‚¹å‡»çš„å­é¡¹å¹¶æ‰§è¡Œç›¸åº”é€»è¾‘ã€‚

public class MainActivity extends AppCompatActivity {
//    private String[] data = {
//      "P1", "P2", "P3", "P4", "P5", "P6", "P7", "P8", "P9", "P10", "P11", "P12", "P13", "P14", "P15"
//    };
    private List<Permission> permissionList = new ArrayList<>();

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
//        ArrayAdapter<String> adapter = new ArrayAdapter<String>(
//                MainActivity.this, android.R.layout.simple_list_item_1, data
//        );
        setContentView(R.layout.activity_main);
        initPermission();
        PermissionAdapter adapter = new PermissionAdapter(MainActivity.this, R.layout.permission_item, permissionList);
        ListView listView = (ListView) findViewById(R.id.list_view);
        listView.setAdapter(adapter);
        listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
                Permission permission = permissionList.get(position);
                Toast.makeText(MainActivity.this, permission.getName(), Toast.LENGTH_SHORT).show();
            }
        });
    }

    private void initPermission() {
        Permission p1 = new Permission("P1");
        permissionList.add(p1);
        Permission p2 = new Permission("P2");
        permissionList.add(p2);
        Permission p3 = new Permission("P3");
        permissionList.add(p3);
        Permission p4 = new Permission("P4");
        permissionList.add(p4);
        Permission p5 = new Permission("P5");
        permissionList.add(p5);
        Permission p6 = new Permission("P6");
        permissionList.add(p6);
        Permission p7 = new Permission("P7");
        permissionList.add(p7);
        Permission p8 = new Permission("P8");
        permissionList.add(p8);
        Permission p9 = new Permission("P9");
        permissionList.add(p9);
        Permission p10 = new Permission("P10");
        permissionList.add(p10);
        Permission p11 = new Permission("P11");
        permissionList.add(p11);
        Permission p12 = new Permission("P12");
        permissionList.add(p12);
        Permission p13 = new Permission("P13");
        permissionList.add(p13);
        Permission p14 = new Permission("P14");
        permissionList.add(p14);
        Permission p15 = new Permission("P15");
        permissionList.add(p15);
    }
}

3.2 Jadxä½¿ç”¨è®°å½•

brew install jadxä¸‹è½½ï¼Œæ‰“å¼€åå°†ä¸åšæ‰‹æœºæ§.apkæ‹–å…¥ï¼Œjadxå®Œæˆå¯¹apkçš„è§£åŒ…å¹¶å¯¹dexåç¼–è¯‘å‡ºjavaä¼ªä»£ç 

å®ç”¨å°tipsï¼š

Tools->Deobfuscationåæ··æ·†åŠŸèƒ½å¯ä»¥å°†éš¾ä»¥åŒºåˆ†çš„aã€bã€cå–ä¸€ä¸ªå”¯ä¸€çš„åå­—

File->Perferencesçš„Decompilationå‹¾é€‰â€œShow inconsistent codeâ€æ˜¾ç¤ºåç¼–è¯‘å¤±è´¥çš„ä»£ç 

3.3 Notification

Android7å’ŒAndroid8å…³äºé€šçŸ¥çš„åˆ›å»ºæ–¹é¢å­˜åœ¨è¾ƒå¤§çš„æ”¹åŠ¨ï¼Œ8å¼•å…¥äº†Notification Channelçš„æ¦‚å¿µï¼Œåœ¨åˆ›å»ºé€šçŸ¥çš„æ—¶å€™éœ€è¦åˆ©ç”¨manageråˆ›å»ºé€šçŸ¥æ¸ é“ä¹‹ååœ¨è¿›è¡Œé€šçŸ¥çš„é…ç½®

æ­¤å¤–ä¸€äº›å…·ä½“çš„APIå’Œå‚æ•°åœ¨å…·ä½“çš„API26ä¸Šä¸‹äº¦æœ‰ä¸€äº›æ”¹åŠ¨åŒ…æ‹¬ä½†ä¸é™äºï¼š

new NotificationChanneléœ€è¦åœ¨26+ä¸Šä½¿ç”¨

manager.createNotificationChannel(notificationChannel)éœ€è¦Android8+ä¸Šåˆ›å»º

new Notification.Builder(MainActivity.this, "channel_id")ä»…æœ‰ä¸€ä¸ªcontextå‚æ•°çš„å€Ÿå£åœ¨Android8+ä¸Šè¢«å¼ƒç”¨

å…·ä½“å®ç°å¦‚ä¸‹ï¼š

				@Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Button button = (Button) findViewById(R.id.button1);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent("com.example.broadcastbp.FORCE_OFFLINE");
                sendBroadcast(intent);
            }
        });

        Button button2 = (Button) findViewById(R.id.button2);
        NotificationManager manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);
        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.O) {
            NotificationChannel notificationChannel = new NotificationChannel("channel_id", "CHANNEL_ID", NotificationManager.IMPORTANCE_DEFAULT);
            manager.createNotificationChannel(notificationChannel);
        }
        Intent intent = new Intent(MainActivity.this, NotificationActivity.class);
        PendingIntent pi = PendingIntent.getActivity(MainActivity.this, 0, intent, PendingIntent.FLAG_IMMUTABLE);

        button2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Notification notification = null;
                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
                    notification = new Notification.Builder(MainActivity.this, "channel_id")
                            .setContentTitle("Title")
                            .setContentText("Text")
                            .setWhen(System.currentTimeMillis())
                            .setSmallIcon(R.mipmap.ic_launcher)
                            .setContentIntent(pi)
                            .setAutoCancel(true)
                            .build();
                }else {
                    notification = new Notification.Builder(MainActivity.this)
                            .setContentTitle("Title")
                            .setContentText("Text")
                            .setWhen(System.currentTimeMillis())
                            .setSmallIcon(R.mipmap.ic_launcher)
                            .setContentIntent(pi)
                            .setAutoCancel(true)
                            .build();
                }
                manager.notify(1, notification);
            }
        });

    }

new NotificationChannelæ—¶çš„ç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šé€šçŸ¥çš„é‡è¦ç¨‹åº¦åŒ…æ‹¬ï¼š

IMPORTANCE_LOWã€IMPORTANCE_DEFAULTã€IMPORTANCE_HIGHã€IMPORTANCE_UNSPECIFIEDã€IMPORTANCE_MINã€IMPORTANCE_NONEå¯¹åº”ä¸åŒçš„é€šçŸ¥æ–¹å¼ï¼ˆéœ‡åŠ¨ï¼Œå¼¹å‡ºã€é€šçŸ¥æ æ˜¾ç¤ºç­‰ï¼‰

é€‚é…çº¯ç™½ä¸€åŠ åçš„ç‰ˆæœ¬ï¼ˆAndroid13ï¼Œ APK33ï¼‰ï¼Œä¸»è¦ä¿®æ”¹äº†è¿è¡Œæ—¶æƒé™ç”³è¯·çš„éƒ¨åˆ†ï¼Œä¸æ‡‚ä¸ºä»€ä¹ˆAndroid10ä¸­åªæ˜¯é™æ€xmlæ³¨å†Œçš„uses- permissionå°±è¡Œï¼Ÿï¼Ÿï¼Ÿ

public class MainActivity extends BaseActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        Button button = (Button) findViewById(R.id.button1);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                Intent intent = new Intent("com.example.broadcastbp.FORCE_OFFLINE");
                sendBroadcast(intent);
            }
        });

        Button button2 = (Button) findViewById(R.id.button2);
        NotificationManager manager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);
        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.O) {
            NotificationChannel notificationChannel = new NotificationChannel("channel_id", "CHANNEL_ID", NotificationManager.IMPORTANCE_DEFAULT);
            manager.createNotificationChannel(notificationChannel);
        }
        Intent intent = new Intent(MainActivity.this, NotificationActivity.class);
        PendingIntent pi = PendingIntent.getActivity(MainActivity.this, 0, intent, PendingIntent.FLAG_IMMUTABLE);

        button2.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (ContextCompat.checkSelfPermission(MainActivity.this, android.Manifest.permission.POST_NOTIFICATIONS) != PackageManager.PERMISSION_GRANTED) {
                    ActivityCompat.requestPermissions(MainActivity.this, new String[]{android.Manifest.permission.POST_NOTIFICATIONS}, 1);
                } else {
                    sendNotification();
                }
            }

            private void sendNotification() {
                Notification notification = null;
                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {
                    notification = new Notification.Builder(MainActivity.this, "channel_id")
                            .setContentTitle("Title")
                            .setContentText("Text")
                            .setWhen(System.currentTimeMillis())
                            .setSmallIcon(R.mipmap.ic_launcher)
                            .setContentIntent(pi)
                            .setAutoCancel(true)
                            .build();
                }else {
                    notification = new Notification.Builder(MainActivity.this)
                            .setContentTitle("Title")
                            .setContentText("Text")
                            .setWhen(System.currentTimeMillis())
                            .setSmallIcon(R.mipmap.ic_launcher)
                            .setContentIntent(pi)
                            .setAutoCancel(true)
                            .build();
                }
                manager.notify(1, notification);
            }
        });
    }
}

æ˜å¤©å¼€å§‹ç ”ç©¶serviceä»¥åŠæƒé™ç®¡ç†ç›¸å…³çŸ¥è¯†ã€‚

3.4 æ‘„åƒå¤´è°ƒç”¨å’ŒåŠ¨é™æ€æƒé™ç”³è¯·

AndroidManifest.xmlä¸­çš„æƒé™å£°æ˜ï¼š

å³ä½¿æ˜¯åŠ¨æ€ç”³è¯·æƒé™ï¼Œä¹Ÿå¿…é¡»åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­è¿›è¡Œå£°æ˜ã€‚è¿™æ˜¯å› ä¸ºè¯¥æ–‡ä»¶ä¸ºæ“ä½œç³»ç»Ÿå’Œç”¨æˆ·æä¾›äº†åº”ç”¨ç¨‹åºæ‰€éœ€æƒé™çš„ä¿¡æ¯ã€‚

å¦‚æœä¸åœ¨AndroidManifest.xmlä¸­å£°æ˜æƒé™ï¼Œå³ä¾¿åœ¨è¿è¡Œæ—¶åŠ¨æ€è¯·æ±‚æƒé™ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šæˆäºˆè¯¥æƒé™ï¼Œå› ä¸ºå®ƒä¸åœ¨åº”ç”¨ç¨‹åºçš„æƒé™åˆ—è¡¨ä¸­ã€‚

åŠ¨æ€æƒé™ç”³è¯·çš„è¿‡ç¨‹ï¼š

åœ¨åº”ç”¨è¿è¡Œæ—¶ï¼Œå½“éœ€è¦ä½¿ç”¨æŸä¸ªå±é™©æƒé™æ—¶ï¼Œåº”ç”¨å¿…é¡»æ£€æŸ¥æ˜¯å¦å·²ç»æ‹¥æœ‰è¯¥æƒé™ã€‚

å¦‚æœåº”ç”¨æ²¡æœ‰è¯¥æƒé™ï¼Œå®ƒå¿…é¡»å‘ç”¨æˆ·è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦è¯¥æƒé™ï¼Œç„¶åè¯·æ±‚ç”¨æˆ·æˆæƒã€‚

ç”¨æˆ·å¯ä»¥é€‰æ‹©æ¥å—æˆ–æ‹’ç»ã€‚å¦‚æœç”¨æˆ·æˆæƒï¼Œåº”ç”¨ç¨‹åºæ‰èƒ½ä½¿ç”¨è¯¥æƒé™

ä»£ç ç¤ºä¾‹

ä¸¤ä¸ªlauncherå¯¹åº”ä¸åŒçš„ActivityResultæ³¨å†Œå›è°ƒï¼ŒåŠŸèƒ½ç±»ä¼¼äºä¹‹å‰çš„requestCode

ç¬¬ä¸€ä¸ªbuttonç‚¹å‡»äº‹ä»¶ä¸­åˆ©ç”¨fileprovideræ„é€ å‡ºimgUriä¹‹åå‘å‡ºéšå¼intentï¼ŒIMAGE_CAPTUREä¸ç”¨æƒé™ï¼Ÿ

ç¬¬äºŒä¸ªbutton1ç‚¹å‡»äº‹ä»¶ä¸­è¿›è¡Œè¿è¡Œæ—¶æƒé™ç”³è¯·ã€‚é‡å†™å›è°ƒå‡½æ•°onRequestPermissionsResultå’ŒonActivityResultã€‚ä½†å®é™…ä¸Šè¿™é‡Œç”³è¯·çš„æƒé™å’Œå®é™…æ‰§è¡ŒopenAlbumæ²¡ç›´æ¥å…³ç³»ï¼ŒæŠŠWRITE_EXTERNAL_STORAGEæ”¹æˆCALL_PHONEä¹‹åæ‰§è¡Œæ—¶ä¼šæç¤ºè¯·æ±‚æ‹¨æ‰“æƒé™ï¼Œå…è®¸è¯¥æƒé™åæ‰èƒ½openAlumï¼Œå±äºæ˜¯å¼ºè¡ŒæŠŠä¸€ä¸ªä¸ç›¸å¹²çš„æƒé™å’ŒopenAlbumç»‘å®šäº†ã€‚


    private ImageView pic;
    private Uri imgUri;
    ActivityResultLauncher launcher = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(), new ActivityResultCallback<ActivityResult>() {
        @Override
        public void onActivityResult(ActivityResult result) {
            if(result.getResultCode() == Activity.RESULT_OK){
                try {
                    Bitmap bitmap = BitmapFactory.decodeStream(getContentResolver().openInputStream(imgUri));
                    pic.setImageBitmap(bitmap);
                } catch (FileNotFoundException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    });

    ActivityResultLauncher launcher1 = registerForActivityResult(new ActivityResultContracts.StartActivityForResult(), new ActivityResultCallback<ActivityResult>() {
        @Override
        public void onActivityResult(ActivityResult o) {
            if(o.getResultCode() == Activity.RESULT_OK) {
                Uri uri = o.getData().getData();
                try {
                    Bitmap bitmap = BitmapFactory.decodeStream(getContentResolver().openInputStream(uri));
                    pic.setImageBitmap(bitmap);
                } catch (FileNotFoundException e) {
                    throw new RuntimeException(e);
                }
            }
        }
    });

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        pic = (ImageView) findViewById(R.id.imageView);
        Button button = findViewById(R.id.take_photo);
        button.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                File outputimg = new File(getExternalCacheDir(),"output_img.jpg");
                try {
                    if (outputimg.exists()){
                        outputimg.delete();
                    }
                } catch (IOError e) {
                    e.printStackTrace();
                }
                imgUri = FileProvider.getUriForFile(MainActivity.this, "com.example.cameratest.fileprovider", outputimg);
                Intent intent = new Intent("android.media.action.IMAGE_CAPTURE");
                intent.putExtra(MediaStore.EXTRA_OUTPUT, imgUri);
                launcher.launch(intent);
            }
        });

        Button button1 = (Button) findViewById(R.id.album);
        button1.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (ContextCompat.checkSelfPermission(MainActivity.this, Manifest.permission.WRITE_EXTERNAL_STORAGE) != PackageManager.PERMISSION_GRANTED) {
                    ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.WRITE_EXTERNAL_STORAGE}, 1);
                } else {
                    openAlbum();
                }
            }
        });
    }

    private void openAlbum() {
        Intent intent = new Intent(Intent.ACTION_OPEN_DOCUMENT);
        intent.addCategory(Intent.CATEGORY_OPENABLE);
        intent.setType("image/*");
        launcher1.launch(intent);
    }

    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
        switch (requestCode) {
            case 1:
                if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                    openAlbum();
                } else {
                    Toast.makeText(this, "you denied the premission", Toast.LENGTH_SHORT).show();
                }
                break;
            default:
        }
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
    }
}

3.5 å‰å°Service

åˆ›å»ºå‰å°Serviceçš„å…³é”®æ­¥éª¤

åœ¨MainActivityä¸­è¿›è¡Œè¿è¡Œæ—¶æƒé™æ£€æŸ¥ï¼ˆAndroidManifest.xmlä¸­ä¹Ÿè¦æ³¨å†Œï¼‰ï¼Œé‡å†™ç”³è¯·ç»“æœå›è°ƒå‡½æ•°

æ„å»ºIntentï¼ˆæ˜¾å¼ï¼‰ï¼Œå¹¶ä½¿ç”¨startForegroundService/starServicå¯åŠ¨æœåŠ¡

ForegroundServiceä¸­åœ¨onCreatä¸­æ„å»ºNotificationChannelå’ŒPendingIntent

ä½¿ç”¨NotificationCompat.Builderåˆ›å»ºé€šçŸ¥ï¼Œä½¿ç”¨startForegroundå¯åŠ¨å‰å°æœåŠ¡

å®ä¾‹ä»£ç å¦‚ä¸‹

package com.example.forageservice;

import android.Manifest;
import android.app.Activity;
import android.app.Notification;
import android.app.NotificationChannel;
import android.content.ComponentName;
import android.content.Intent;
import android.content.ServiceConnection;
import android.content.pm.PackageManager;
import android.os.Build;
import android.os.Bundle;
import android.os.IBinder;
import android.view.View;
import android.widget.Button;
import android.widget.Toast;

import androidx.activity.EdgeToEdge;
import androidx.annotation.NonNull;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.app.ActivityCompat;
import androidx.core.app.NotificationCompat;
import androidx.core.app.NotificationManagerCompat;
import androidx.core.graphics.Insets;
import androidx.core.view.ViewCompat;
import androidx.core.view.WindowInsetsCompat;

public class MainActivity extends AppCompatActivity {
    private MyService.DownloadBinder downloadBinder;
    private NotificationCompat.Builder builder;
    private NotificationManagerCompat manager;


    private void checkPostNotificationPremission() {
        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.POST_NOTIFICATIONS)
            != PackageManager.PERMISSION_GRANTED) {
            ActivityCompat.requestPermissions((Activity) this, new String[]{Manifest.permission.POST_NOTIFICATIONS}, 200);
        } else if(manager != null) {
            manager.notify(2, builder.build());
        }
    }

    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == 200) {
            if(grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                Toast.makeText(this, "ç”³è¯·æƒé™æˆåŠŸ", Toast.LENGTH_SHORT).show();
            } else {
                Toast.makeText(this, "ç”³è¯·æƒé™å¤±è´¥", Toast.LENGTH_SHORT).show();
            }
        }
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        Button start_forage_service = (Button) findViewById(R.id.start_forage_service);

        start_forage_service.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {
                    checkPostNotificationPremission();
                }

                Intent intent = new Intent(MainActivity.this, ForegroundService.class);
                if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.O) {
                    startForegroundService(intent);
                } else {
                    startService(intent);
                }
            }
        });
    }
}



package com.example.forageservice;

import android.annotation.SuppressLint;
import android.app.Notification;
import android.app.NotificationChannel;
import android.app.NotificationManager;
import android.app.PendingIntent;
import android.app.Service;
import android.content.Intent;
import android.os.Build;
import android.os.IBinder;
import android.util.Log;

import androidx.core.app.NotificationCompat;

public class ForegroundService extends Service {
    public ForegroundService() {
    }

    @SuppressLint("ForegroundServiceType")
    @Override
    public void onCreate() {
        super.onCreate();
        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.O) {
            CharSequence name = getString(R.string.app_name);
            int importance = NotificationManager.IMPORTANCE_DEFAULT;
            NotificationChannel channel = new NotificationChannel("CHANNEL_ID", name, importance);
            NotificationManager notificationManager = getSystemService(NotificationManager.class);
            notificationManager.createNotificationChannel(channel);
        }

        Intent intent = new Intent(this, MainActivity.class);
        intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TOP);
        PendingIntent pendingIntent = PendingIntent.getActivity(this, 1, intent,PendingIntent.FLAG_IMMUTABLE | PendingIntent.FLAG_ONE_SHOT);

        NotificationCompat.Builder builder = new NotificationCompat.Builder(this, "CHANNEL_ID")
                .setSmallIcon(R.mipmap.ic_launcher)
                .setContentTitle(getString(R.string.app_name))
                .setContentText("Content Text")
                .setPriority(NotificationCompat.PRIORITY_DEFAULT)
                .setContentIntent(pendingIntent);

        startForeground(1, builder.build());
    }

    @Override
    public int onStartCommand(Intent intent, int flags, int startId) {
        return START_STICKY;
    }

    @Override
    public IBinder onBind(Intent intent) {
        // TODO: Return the communication channel to the service.
        return null;
    }

    @Override
    public void onDestroy() {
        super.onDestroy();
        Log.d("ForegroundService", "onDestroy: executed");
        stopForeground(true);
        stopSelf();
    }
}

çœ‹åˆ°onStartCommandè¿”å›START_STICKYï¼Œè¯¥è¿”å›å€¼ä½¿å¾—åº”ç”¨è¿›ç¨‹åœ¨å¼‚å¸¸é€€å‡ºæ—¶è¯¥Serivceä»ç„¶ä¼šè¢«é‡æ–°å¯åŠ¨ï¼Œä½†æ˜¯onStartCommandå›è°ƒæ–¹æ³•çš„Intentå‚æ•°ä¸ºnullã€‚æä¾›æœåŠ¡ä¿æ´»çš„æ–°æ€è·¯ï¼Ÿ

START_STICKY is a useful Service that performs background tasks. These Services need to continue running in the background even if the user switches to another app or device. By using START_STICKY you can ensure that your service continues to run even if it is killed or stopped.

Constant to return from onStartCommand: if this service's process is killed while it is started (after returning from onStartCommand), then leave it in the started state but don't retain this delivered intent. Later the system will try to re-create the service. Because it is in the started state, it will guarantee to call onStartCommand after creating the new service instance; if there are not any pending start commands to be delivered to the service, it will be called with a null intent object, so you must take care to check for this.

This mode makes sense for things that will be explicitly started and stopped to run for arbitrary periods of time, such as a service performing background music playback.

Since Android version Build.VERSION_CODES.S, apps targeting Build.VERSION_CODES.S or above are disallowed to start a foreground service from the background, but the restriction doesn't impact restarts of a sticky foreground service. However, when apps start a sticky foreground service from the background, the same restriction still applies

åº”ç”¨è¢«è§†ä¸ºå¤„äºå‰å°çš„æ¡ä»¶ï¼š

å…·æœ‰å¯è§ Activity

å…·æœ‰å‰å° Service

å¦ä¸€ä¸ªå‰å°åº”ç”¨å·²å…³è”åˆ°è¯¥åº”ç”¨

Android8.0ä¹‹åå¢åŠ äº†ä¸€äº›é’ˆå¯¹åå°åº”ç”¨å¯åŠ¨åå°æœåŠ¡çš„é™åˆ¶ç­–ç•¥ï¼Œå¹¶ä¸”å¿…é¡»ä½¿ç”¨startForegroundServiceæ–¹æ³•æ¥å¯åŠ¨å‰å°æœåŠ¡

å¦‚æœåº”ç”¨å¤„äºåå°ï¼Œå°±å¯åŠ¨ä¸€ä¸ªé€æ˜çš„ã€ç”¨æˆ·æ— æ„ŸçŸ¥çš„ Activityï¼Œå°†åº”ç”¨åˆ‡æ¢åˆ°å‰å°ï¼Œç„¶åå†é€šè¿‡ startService å¯åŠ¨æœåŠ¡ï¼Œéšå finish æ‰é€æ˜ Activity

ä½¿ç”¨bindServiceå¯åŠ¨åå°æœåŠ¡

äº†è§£Android 12çš„åå°é™åˆ¶

åœ¨Android 12ä¸­ï¼Œç³»ç»Ÿå¯¹åå°åº”ç”¨çš„æƒé™è¿›è¡Œäº†æ›´åŠ ä¸¥æ ¼çš„é™åˆ¶ï¼Œç‰¹åˆ«æ˜¯åœ¨åå°å¯åŠ¨Serviceæ–¹é¢ã€‚ä¾‹å¦‚ï¼Œä¸€äº›éšå¼å¹¿æ’­æ¥æ”¶å™¨åœ¨åå°ä¸å†æ¥æ”¶å¹¿æ’­ï¼Œè¿™å¯èƒ½ä¼šå½±å“åˆ°ä¸€äº›éœ€è¦ç›‘å¬ç³»ç»Ÿäº‹ä»¶çš„åº”ç”¨ã€‚å› æ­¤ï¼Œå¼€å‘è€…éœ€è¦äº†è§£è¿™äº›é™åˆ¶ï¼Œå¹¶ç›¸åº”åœ°è°ƒæ•´è‡ªå·±çš„åº”ç”¨ã€‚

ä½¿ç”¨JobScheduleræˆ–WorkManagerè°ƒåº¦åå°ä»»åŠ¡

ä¸ºäº†ç»•è¿‡è¿™äº›é™åˆ¶ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨JobScheduleræˆ–WorkManageræ¥è°ƒåº¦åå°ä»»åŠ¡ã€‚JobScheduleræ˜¯Androidç³»ç»Ÿæä¾›çš„ä¸€ä¸ªAPIï¼Œå…è®¸å¼€å‘è€…åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å®‰æ’å»¶è¿Ÿæ‰§è¡Œçš„ä»»åŠ¡ã€‚è€ŒWorkManageråˆ™æ˜¯ä¸€ä¸ªæ›´é«˜çº§åˆ«çš„æŠ½è±¡ï¼Œå®ƒç®€åŒ–äº†åå°ä»»åŠ¡çš„è°ƒåº¦å’Œç®¡ç†ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿæ›´è½»æ¾åœ°å¤„ç†åå°ä»»åŠ¡ã€‚

ä½¿ç”¨ForegroundServiceåœ¨å‰å°è¿è¡ŒService

å¦‚æœServiceéœ€è¦é•¿æ—¶é—´è¿è¡Œå¹¶ä¸”éœ€è¦æ‰§è¡Œä¸€äº›å…³é”®ä»»åŠ¡ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘å°†Serviceè®¾ç½®ä¸ºå‰å°Serviceã€‚å‰å°Serviceä¼šåœ¨é€šçŸ¥æ æ˜¾ç¤ºä¸€ä¸ªæŒç»­çš„é€šçŸ¥ï¼Œå‘Šè¯‰ç”¨æˆ·Serviceæ­£åœ¨è¿è¡Œã€‚è¿™æ ·ï¼Œå³ä½¿åº”ç”¨å¤„äºåå°ï¼ŒServiceä¹Ÿèƒ½ç»§ç»­è¿è¡Œï¼Œä¸ä¼šè¢«ç³»ç»Ÿè½»æ˜“æ€æ­»ã€‚

ä½¿ç”¨Sticky Serviceç¡®ä¿Serviceé‡å¯

åœ¨Android 12ä¸­ï¼Œå½“åº”ç”¨è¢«æ€æ­»æ—¶ï¼Œåå°Serviceå¯èƒ½ä¹Ÿä¼šå—åˆ°å½±å“ã€‚ä¸ºäº†ç¡®ä¿Serviceåœ¨åº”ç”¨é‡å¯åèƒ½å¤Ÿè‡ªåŠ¨æ¢å¤ï¼Œå¯ä»¥ä½¿ç”¨Sticky Serviceã€‚é€šè¿‡è®¾ç½®Serviceçš„å¯åŠ¨æ¨¡å¼ä¸ºSTICKYï¼Œå½“åº”ç”¨é‡å¯æ—¶ï¼Œç³»ç»Ÿä¼šå°è¯•é‡æ–°åˆ›å»ºServiceï¼Œç¡®ä¿å®ƒèƒ½å¤Ÿç»§ç»­è¿è¡Œã€‚

ä½¿ç”¨è‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶å™¨ç›‘å¬ç³»ç»Ÿäº‹ä»¶

ç”±äºAndroid 12å¯¹éšå¼å¹¿æ’­æ¥æ”¶å™¨çš„é™åˆ¶ï¼Œå¼€å‘è€…å¯èƒ½éœ€è¦ä½¿ç”¨è‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶å™¨æ¥ç›‘å¬ç³»ç»Ÿäº‹ä»¶ã€‚é€šè¿‡åœ¨åº”ç”¨ä¸­æ³¨å†Œè‡ªå®šä¹‰å¹¿æ’­æ¥æ”¶å™¨ï¼Œå¹¶åœ¨éœ€è¦æ—¶å‘é€å¹¿æ’­ï¼Œå¯ä»¥å®ç°ä¸ç³»ç»Ÿçš„é€šä¿¡ï¼Œä»è€Œè§¦å‘åå°Serviceçš„å¯åŠ¨ã€‚

3.6 æƒé™ç®¡ç†

è·å–å­˜å‚¨ç©ºé—´è®¿é—®æƒé™

æ‹¨æ‰“å’Œç®¡ç†ç”µè¯æƒé™

å‘é€é€šçŸ¥æƒé™

å¿½ç•¥ç”µæ± ä¼˜åŒ–æƒé™

åœ¨å…¶ä»–åº”ç”¨ä¹‹ä¸Šæ˜¾ç¤ºæƒé™ï¼ˆæ‚¬æµ®çª—å£æƒé™ï¼‰

ä½¿ç”¨è®¿é—®è®¾ç½®æƒé™

é€šçŸ¥æ è®¾ç½®æƒé™

è¾…åŠ©æœåŠ¡åŠŸèƒ½è®¾ç½®æƒé™

ç”³è¯·æƒé™çš„æ€è·¯æ˜¯èƒ½å¤Ÿåˆ©ç”¨é™æ€å£°æ˜æƒé™æˆ–è€…åŠ¨æ€è¿è¡Œæ—¶æƒé™ç”³è¯·çš„æƒé™å°±ä½¿ç”¨è‡ªåŠ¨ç”³è¯·çš„æ–¹å¼è·å–ï¼Œä¸€äº›ç‰¹æ®Šæƒé™å°±å°½å¯èƒ½çš„è·³è½¬åˆ°Settingsé‡Œé™„è¿‘çš„Activityæ‰‹åŠ¨çš„ç‚¹å‡»è·å–ã€‚

èƒ½å¤Ÿé€šè¿‡å‰è€…è·å–åˆ°çš„æƒé™å¤§éƒ¨åˆ†æ˜¯æ™®é€šç”¨æˆ·æƒé™ï¼Œå½“æƒ³è¦è·å–å±é™©æƒé™è‡ªåŠ¨è·å–è¡Œä¸é€šï¼Œå› æ­¤è€ƒè™‘å¦‚ä½•ä»appç›´æ¥è·³è½¬åˆ°Settingå¯¹åº”æƒé™è®¾ç½®çš„Activityï¼ˆå‰æä¹Ÿæ˜¯è¦é™æ€å£°æ˜æƒé™æˆ–è€…åŠ¨æ€è¿è¡Œè·å–å¤±è´¥ï¼‰

è¦æƒ³å®ç°è·³è½¬è‡ªç„¶æƒ³åˆ°ä½¿ç”¨Intentï¼Œå¦‚æœæ˜¯æ˜¾å¼Intentéœ€è¦çŸ¥é“è¦è·³è½¬çš„Activiyç±»åï¼Œä½¿ç”¨éšå¼Intentéœ€è¦æŒ‡å®šæ­£ç¡®çš„actionï¼Œå¹¶ä¸”ç»“æœå¯èƒ½ä¸å”¯ä¸€ï¼Œå› æ­¤é€‰æ‹©ä½¿ç”¨setComponentæ„é€ æ˜¾å¼Intent

    private void checkNotificationAccessSettingPermission(Context context) {
        Intent boot_intent = new Intent();
        boot_intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
        ComponentName componentName = ComponentName.unflattenFromString("com.android.settings/.Settings$NotificationAccessSettingsActivity");
        boot_intent.setData(Uri.fromParts("package", context.getPackageName(), null));
        boot_intent.setComponent(componentName);
        startActivity(boot_intent);
    }

ComponentName.unflattenFromString(String str)Â æ˜¯ä¸€ä¸ªç”¨äºä»å­—ç¬¦ä¸²åˆ›å»ºÂ ComponentNameÂ å¯¹è±¡çš„é™æ€æ–¹æ³•ã€‚è¯¥å­—ç¬¦ä¸²é€šå¸¸æ˜¯ç”±Â flattenToString()Â æ–¹æ³•ç”Ÿæˆçš„ï¼Œå®ƒå°†åŒ…åå’Œç±»ååˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

ä¼ é€’ç»™Â unflattenFromStringÂ æ–¹æ³•çš„å­—ç¬¦ä¸²åº”è¯¥æ˜¯Â åŒ…å/ç±»åÂ çš„æ ¼å¼ã€‚å¦‚æœç±»åæ˜¯åŒ…å†…çš„ï¼Œåˆ™å‰é¢å¯ä»¥ç›´æ¥åŠ Â .Â ä½œä¸ºç®€å†™ã€‚å¦‚æœç±»åæ˜¯åµŒå¥—çš„å†…éƒ¨ç±»ï¼Œåˆ™å†…éƒ¨ç±»åå‰éœ€è¦åŠ ä¸ŠÂ $Â ç¬¦å·ã€‚

ä¸Šè¿°ä»ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­åˆ›å»ºä¸€ä¸ª ComponentName å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æŒ‡å‘ com.android.settings åŒ…ä¸‹çš„ Settings ç±»ä¸­çš„ NotificationAccessSettingsActivity å†…éƒ¨ç±»ã€‚è¿™æ ·åˆ›å»ºçš„ ComponentName å¯¹è±¡å¯ä»¥ç”¨äºæ„å»ºæ˜¾å¼Intentï¼Œä»¥å¯åŠ¨æŒ‡å®šçš„ç»„ä»¶ã€‚

å¦‚ä½•è·å–æ„é€ Componentå¯¹è±¡çš„åŒ…åå’Œç±»åå‘¢ï¼Ÿ

æ€è·¯1ï¼šæ‰¾åˆ°googleå¼€æºçš„Androidå¹³å°ä»£ç åŒ…å«æœ‰Setttingsé¡¹ç›®æºç ï¼ŒæŸ¥çœ‹å…¶ä¸­çš„AndroidManifest.xmlç¡®å®šäº†Activityåä¹Ÿå°±çŸ¥é“äº†ç±»åã€‚

å­˜åœ¨é—®é¢˜ï¼šèƒ½å¤Ÿç¡®å®šAndoridå¹³å°è®¾ç½®è®¾ç½®çš„ç±»åï¼Œä½†ä¸åŒæ‰‹æœºå‚å•†å®šåˆ¶çš„Activityæ€ä¹ˆè°ƒå‘¢ï¼Ÿ

æ€è·¯2ï¼špm path <packagename> + adb pullå°†æ‰‹æœºä¸Šçš„Setting.apk pullåˆ°ç”µè„‘ä¸Šç”¨Jadxè§£åŒ…é€†å‡ºAndroidManifest.xmlçš„å†…å®¹ã€‚

å­˜åœ¨é—®é¢˜ï¼šSetting.apkä½œä¸ºç³»ç»Ÿè½¯ä»¶å¯èƒ½ä½äºä¸å¯è®¿é—®çš„è·¯å¾„ä¸‹

æ€è·¯3ï¼šä¸åšæ‰‹æœºæ§é‡Œç‚¹å‡»æƒé™ç®¡ç†ååˆ©ç”¨adb shell dumpsys activity activitiesæŸ¥çœ‹task top activity

å­˜åœ¨é—®é¢˜ï¼šè·å–åˆ°çš„Activiyæ¯”è¾ƒæœ‰é™ï¼Œä¸‡ä¸€ä¸åšæ‰‹æœºæ§é‡Œæ²¡å®ç°å¯¹åº”åŠŸèƒ½å°±æŠ“çäº†ã€‚ä¸å¤ªæ‡‚ä¸ºå•¥è‡ªå·±ä»Settingsä¸€è·¯ç‚¹å‡»åˆ°ç›®æ ‡Activiyå†ç”¨adb shell dumpsysçœ‹å°½ç®¡æ˜¯åŒä¸€Activityä½†éƒ½æ˜¯SubSettings......

å¯¹äºsignatureå’ŒsignatureOrSystemä¿æŠ¤çº§åˆ«çš„è‡ªå®šä¹‰æƒé™ï¼Œåªæœ‰ç­¾åç›¸åŒçš„åº”ç”¨æˆ–ç³»ç»Ÿåº”ç”¨æ‰èƒ½è·å–è¿™äº›æƒé™ï¼Œå› æ­¤ä¸éœ€è¦åŠ¨æ€ç”³è¯·

ç›®å‰é‡åˆ°çš„ä¸èƒ½ç”³è¯·æƒé™/è·³è½¬åˆ°æŒ‡å®šActivityé—®é¢˜ï¼š

1ã€ç›®æ ‡Activityä¸­å£°æ˜<android:permisssion>è‡ªå®šä¹‰æƒé™ä¸”ä¿æŠ¤çº§åˆ«ä¸ºsignatureæˆ–è€…ç›´æ¥ä¸ºç³»ç»Ÿæƒé™

2ã€ä¸åŒAndroidç‰ˆæœ¬ä¹‹é—´æƒé™å£°æ˜æ–¹å¼å˜åŠ¨

3ã€ç›®æ ‡Activityæœªå£°æ˜ä¸ºexportedï¼Œæˆ–è€…ä¸çŸ¥é“ç›®æ ‡Activityçš„åŒ…åå’Œå…·ä½“ç±»å

4ã€æœ‰äº›Activityè™½ç„¶èƒ½æ­£ç¡®è·³è½¬ä½†æ— æ³•æ‰‹åŠ¨ç‚¹å‡»èµ‹äºˆæƒé™ã€‚ï¼ˆç‚¹æŒ‰å¸¸ç°ï¼‰